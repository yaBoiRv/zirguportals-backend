generator client {
  provider = "prisma-client-js"
  // You can remove previewFeatures; Prisma warns it's deprecated
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "auth"]
}

model User {
  id    String @id @default(uuid()) @db.Uuid
  email String @unique

  passwordHash  String  @map("password_hash")
  emailVerified Boolean @default(false) @map("email_verified")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  profile Profile?

  conversations ConversationParticipant[]
  messages      Message[]
  announcements Announcements[]
  forumTopics   ForumTopic[]
  forumReplies  ForumReply[]
  forumLikes    ForumLike[]

  @@map("users")
  @@schema("auth")
}

model Profile {
  id     String @id @default(uuid()) @db.Uuid
  userId String @unique @map("user_id") @db.Uuid

  name              String  @default("")
  username          String? @unique
  avatarUrl         String? @map("avatar_url")
  phone             String?
  hasTrainerProfile Boolean @default(false) @map("has_trainer_profile")

  notificationPreferences Json   @map("notification_preferences")
  defaultLanguage         String @default("en") @map("default_language")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("profiles")
  @@schema("public")
}

model Conversation {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  participants ConversationParticipant[]
  messages     Message[]

  @@schema("public")
}

model ConversationParticipant {
  id             String   @id @default(uuid()) @db.Uuid
  conversationId String   @db.Uuid
  userId         String   @db.Uuid
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@schema("public")
}

model Message {
  id             String   @id @default(uuid()) @db.Uuid
  conversationId String   @db.Uuid
  senderId       String   @db.Uuid
  body           String
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@schema("public")
}

// --- Dictionaries ---

model AnnouncementCategory {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  icon  String?
  translations AnnouncementCategoryTranslation[]
  @@map("announcement_categories")
  @@schema("public")
}

model AnnouncementCategoryTranslation {
  id          Int     @id @default(autoincrement())
  categoryId  Int     @map("category_id")
  langCode    String  @map("lang_code")
  name        String
  category    AnnouncementCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  @@unique([categoryId, langCode])
  @@map("announcement_category_translations")
  @@schema("public")
}

model Country {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations CountryTranslation[]
  @@map("countries")
  @@schema("public")
}

model CountryTranslation {
  id        Int     @id @default(autoincrement())
  countryId Int     @map("country_id")
  langCode  String  @map("lang_code")
  name      String
  country   Country @relation(fields: [countryId], references: [id], onDelete: Cascade)
  @@unique([countryId, langCode])
  @@map("country_translations")
  @@schema("public")
}

model EquipmentBrand {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  name  String
  @@map("equipment_brands")
  @@schema("public")
}

model EquipmentColor {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  hex   String?
  translations EquipmentColorTranslation[]
  @@map("equipment_colors")
  @@schema("public")
}

model EquipmentColorTranslation {
  id       Int     @id @default(autoincrement())
  colorId  Int     @map("color_id")
  langCode String  @map("lang_code")
  name     String
  color    EquipmentColor @relation(fields: [colorId], references: [id], onDelete: Cascade)
  @@unique([colorId, langCode])
  @@map("equipment_color_translations")
  @@schema("public")
}

model EquipmentCondition {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations EquipmentConditionTranslation[]
  @@map("equipment_conditions")
  @@schema("public")
}

model EquipmentConditionTranslation {
  id          Int     @id @default(autoincrement())
  conditionId Int     @map("condition_id")
  langCode    String  @map("lang_code")
  name        String
  condition   EquipmentCondition @relation(fields: [conditionId], references: [id], onDelete: Cascade)
  @@unique([conditionId, langCode])
  @@map("equipment_condition_translations")
  @@schema("public")
}

model EquipmentType {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations EquipmentTypeTranslation[]
  materials EquipmentMaterial[]
  @@map("equipment_types")
  @@schema("public")
}

model EquipmentTypeTranslation {
  id      Int     @id @default(autoincrement())
  typeId  Int     @map("type_id")
  langCode String @map("lang_code")
  name    String
  type    EquipmentType @relation(fields: [typeId], references: [id], onDelete: Cascade)
  @@unique([typeId, langCode])
  @@map("equipment_type_translations")
  @@schema("public")
}

model EquipmentMaterial {
  id              Int     @id @default(autoincrement())
  key             String  @unique
  equipmentTypeId Int?    @map("equipment_type_id")
  equipmentType   EquipmentType? @relation(fields: [equipmentTypeId], references: [id])
  translations    EquipmentMaterialTranslation[]
  @@map("equipment_materials")
  @@schema("public")
}

model EquipmentMaterialTranslation {
  id          Int     @id @default(autoincrement())
  materialId  Int     @map("material_id")
  langCode    String  @map("lang_code")
  name        String
  material    EquipmentMaterial @relation(fields: [materialId], references: [id], onDelete: Cascade)
  @@unique([materialId, langCode])
  @@map("equipment_material_translations")
  @@schema("public")
}

model ForumCategory {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  icon  String?
  translations ForumCategoryTranslation[]
  @@map("forum_categories")
  @@schema("public")
}

model ForumCategoryTranslation {
  id          Int     @id @default(autoincrement())
  categoryId  Int     @map("category_id")
  langCode    String  @map("lang_code")
  name        String
  description String?
  category    ForumCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  @@unique([categoryId, langCode])
  @@map("forum_category_translations")
  @@schema("public")
}

model HorseBreed {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations HorseBreedTranslation[]
  @@map("horse_breeds")
  @@schema("public")
}

model HorseBreedTranslation {
  id       Int     @id @default(autoincrement())
  breedId  Int     @map("breed_id")
  langCode String  @map("lang_code")
  name     String
  breed    HorseBreed @relation(fields: [breedId], references: [id], onDelete: Cascade)
  @@unique([breedId, langCode])
  @@map("horse_breed_translations")
  @@schema("public")
}

model PonyBreed {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations PonyBreedTranslation[]
  @@map("pony_breeds")
  @@schema("public")
}

model PonyBreedTranslation {
  id       Int     @id @default(autoincrement())
  breedId  Int     @map("breed_id")
  langCode String  @map("lang_code")
  name     String
  breed    PonyBreed @relation(fields: [breedId], references: [id], onDelete: Cascade)
  @@unique([breedId, langCode])
  @@map("pony_breed_translations")
  @@schema("public")
}

model HorseColor {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  hex   String?
  translations HorseColorTranslation[]
  @@map("horse_colors")
  @@schema("public")
}

model HorseColorTranslation {
  id       Int     @id @default(autoincrement())
  colorId  Int     @map("color_id")
  langCode String  @map("lang_code")
  name     String
  color    HorseColor @relation(fields: [colorId], references: [id], onDelete: Cascade)
  @@unique([colorId, langCode])
  @@map("horse_color_translations")
  @@schema("public")
}

model HorseDiscipline {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations HorseDisciplineTranslation[]
  @@map("horse_disciplines")
  @@schema("public")
}

model HorseDisciplineTranslation {
  id           Int     @id @default(autoincrement())
  disciplineId Int     @map("discipline_id")
  langCode     String  @map("lang_code")
  name         String
  discipline   HorseDiscipline @relation(fields: [disciplineId], references: [id], onDelete: Cascade)
  @@unique([disciplineId, langCode])
  @@map("horse_discipline_translations")
  @@schema("public")
}

model HorseSex {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations HorseSexTranslation[]
  @@map("horse_sex")
  @@schema("public")
}

model HorseSexTranslation {
  id    Int     @id @default(autoincrement())
  sexId Int     @map("sex_id")
  langCode String @map("lang_code")
  name  String
  sex   HorseSex @relation(fields: [sexId], references: [id], onDelete: Cascade)
  @@unique([sexId, langCode])
  @@map("horse_sex_translations")
  @@schema("public")
}

model HorseTemperament {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations HorseTemperamentTranslation[]
  @@map("horse_temperament")
  @@schema("public")
}

model HorseTemperamentTranslation {
  id            Int     @id @default(autoincrement())
  temperamentId Int     @map("temperament_id")
  langCode      String  @map("lang_code")
  name          String
  temperament   HorseTemperament @relation(fields: [temperamentId], references: [id], onDelete: Cascade)
  @@unique([temperamentId, langCode])
  @@map("horse_temperament_translations")
  @@schema("public")
}

model ServiceSpecialty {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations ServiceSpecialtyTranslation[]
  @@map("service_specialties")
  @@schema("public")
}

model ServiceSpecialtyTranslation {
  id          Int     @id @default(autoincrement())
  specialtyId Int     @map("specialty_id")
  langCode    String  @map("lang_code")
  name        String
  specialty   ServiceSpecialty @relation(fields: [specialtyId], references: [id], onDelete: Cascade)
  @@unique([specialtyId, langCode])
  @@map("service_specialty_translations")
  @@schema("public")
}

model TrainerSpecialty {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations TrainerSpecialtyTranslation[]
  @@map("trainer_specialties")
  @@schema("public")
}

model TrainerSpecialtyTranslation {
  id          Int     @id @default(autoincrement())
  specialtyId Int     @map("specialty_id")
  langCode    String  @map("lang_code")
  name        String
  specialty   TrainerSpecialty @relation(fields: [specialtyId], references: [id], onDelete: Cascade)
  @@unique([specialtyId, langCode])
  @@map("trainer_specialty_translations")
  @@schema("public")
}

model TrainerLanguage {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  name  String? 
  @@map("trainer_languages")
  @@schema("public")
}

model TrainerCertification {
  id    Int     @id @default(autoincrement())
  key   String  @unique
  translations TrainerCertificationTranslation[]
  @@map("trainer_certifications")
  @@schema("public")
}

model TrainerCertificationTranslation {
  id              Int     @id @default(autoincrement())
  certificationId Int     @map("certification_id")
  langCode        String  @map("lang_code")
  name            String
  certification   TrainerCertification @relation(fields: [certificationId], references: [id], onDelete: Cascade)
  @@unique([certificationId, langCode])
  @@map("trainer_certification_translations")
  @@schema("public")
}

model Announcements {
  id          String    @id @default(uuid()) @db.Uuid
  title       String
  content     String
  category    String
  is_pinned   Boolean   @default(false) @map("is_pinned")
  pinned_until DateTime? @map("pinned_until")
  images      String[]
  files       String[]
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  userId      String    @map("user_id") @db.Uuid

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([category])
  @@map("announcements")
  @@schema("public")
}

model ForumTopic {
  id          String   @id @default(uuid()) @db.Uuid
  title       String
  content     String
  category    String
  userId      String   @map("user_id") @db.Uuid
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  images      String[] @default([])
  files       String[] @default([])
  
  likesCount   Int      @default(0) @map("likes_count")
  repliesCount Int      @default(0) @map("replies_count")
  viewsCount   Int      @default(0) @map("views_count")

  replies     ForumReply[]
  likes       ForumLike[]

  @@map("forum_topics")
  @@schema("public")
}

model ForumReply {
  id              String   @id @default(uuid()) @db.Uuid
  topicId         String   @map("topic_id") @db.Uuid
  topic           ForumTopic @relation(fields: [topicId], references: [id], onDelete: Cascade)
  
  userId          String   @map("user_id") @db.Uuid
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  content         String
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  images          String[] @default([])
  files           String[] @default([])

  parentId        String?  @map("parent_id") @db.Uuid
  parent          ForumReply? @relation("ReplyToReply", fields: [parentId], references: [id])
  children        ForumReply[] @relation("ReplyToReply")

  likesCount      Int      @default(0) @map("likes_count")
  likes           ForumLike[]

  @@map("forum_replies")
  @@schema("public")
}

model ForumLike {
  id        String   @id @default(uuid()) @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  topicId   String?  @map("topic_id") @db.Uuid
  topic     ForumTopic? @relation(fields: [topicId], references: [id], onDelete: Cascade)

  replyId   String?  @map("reply_id") @db.Uuid
  reply     ForumReply? @relation(fields: [replyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, topicId])
  @@unique([userId, replyId])
  @@map("forum_likes")
  @@schema("public")
}
